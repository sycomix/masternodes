<!DOCTYPE html>
<html lang="en">
<head>
    <title>Masternode List</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="{{ url_for('static', filename='js/jquery.js') }}">\x3C/script>')</script>
	<script type=text/javascript>
		  $SCRIPT_ROOT = {{ request.script_root|tojson|safe }};
	</script>

</head>
<body>

<script type=text/javascript>
    /*
  $(function() {
    $('a#loadmn').bind('click', function() {
      $.getJSON($SCRIPT_ROOT + '/masternodestatus', {
        mnidx: $('input[name="a"]').val(),
      }, function(data) {
        $("#result").text(data.result);
      });
      return false;
    });
    */

  function updateStatus(mn_status)
    {
      mn_status.text('Updating...')

      $.getJSON($SCRIPT_ROOT+'/cli/masternode/status', { mnidx: mn_status.attr("id")  }, function(data) {
          console.log("Loading details for mn; "+ mn_status.attr("id"));
          console.log(data)
          
          if(data.status.startsWith("restart"))
          {
              mn_status.text("Down, Restart mn daemon:")
              mn_status.append("<a href='/daemon/launch?mn="+mn_status.attr("id")+"'>start polisd</a>");
          }
          else{
              mn_status.text(data.status)
          }
          
          // Fill table with masternode list.
          // data: should contain json with IP:index in list and name of masternode( if in config) 
      }); 

    }
  $('.update').bind('click', function() {
      var id = '#'+$(this).attr('id')

      console.log("Updating status for : "+ id);
      updateStatus($(id)) 
  });

  $( document ).ready(function() {
      console.log("Document ready")

      $(".status").each(function(){ 
          var mn_status = $(this); 
          console.log("Filling up masternodes table"+ mn_status.attr("id"));
          updateStatus(mn_status)
      });
  });
</script>
<h1>jQuery Masternode update status</h1>


    <ul id="masternodes">
    {% for item in masternodes %}
    <li>{{ item.cnx }} | <button class='update' id='{{ item.idx }}' href='#'>update {{item.idx}}</button> <div class='status' id='{{item.idx}}'/>   </li>
    {% endfor %}
    </ul>



    {#    <ul id="masternodes">
    {% for item in masternodes %}
	    <li>{{ item }}</li>
    {% endfor %}
    </ul>
    #}}

</body>
</html>
